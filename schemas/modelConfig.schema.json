{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://ubi-simulator.example.com/schemas/modelConfig.json",
  "title": "ModelConfig",
  "description": "Schema for user-uploadable economic model configurations",
  "type": "object",
  "required": ["id", "name", "description", "parameters", "equations", "metadata"],
  "additionalProperties": false,

  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[a-z0-9-]+$",
      "minLength": 3,
      "maxLength": 50,
      "description": "Unique identifier for the model (lowercase, hyphens allowed)"
    },

    "name": {
      "type": "string",
      "minLength": 3,
      "maxLength": 100,
      "description": "Human-readable name for the model"
    },

    "description": {
      "type": "string",
      "minLength": 10,
      "maxLength": 1000,
      "description": "Detailed description of what this model represents"
    },

    "parameters": {
      "type": "array",
      "minItems": 1,
      "maxItems": 20,
      "items": {
        "$ref": "#/definitions/ParameterConfig"
      },
      "description": "Model parameters that can be adjusted"
    },

    "equations": {
      "$ref": "#/definitions/EquationSet"
    },

    "metadata": {
      "$ref": "#/definitions/ModelMetadata"
    }
  },

  "definitions": {
    "ParameterConfig": {
      "type": "object",
      "required": ["name", "min", "max", "default", "description"],
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string",
          "pattern": "^[a-zA-Z][a-zA-Z0-9_]*$",
          "minLength": 1,
          "maxLength": 50,
          "description": "Parameter name (valid JavaScript identifier)"
        },
        "min": {
          "type": "number",
          "description": "Minimum allowed value"
        },
        "max": {
          "type": "number",
          "description": "Maximum allowed value"
        },
        "default": {
          "type": "number",
          "description": "Default value (must be between min and max)"
        },
        "description": {
          "type": "string",
          "minLength": 5,
          "maxLength": 200,
          "description": "Human-readable description of this parameter"
        },
        "unit": {
          "type": "string",
          "maxLength": 20,
          "description": "Optional unit (e.g., '%', 'USD', 'months')"
        }
      }
    },

    "EquationSet": {
      "type": "object",
      "required": ["aiAdoptionGrowth", "surplusGeneration", "wellbeingDelta", "displacementFriction", "ubiUtility"],
      "additionalProperties": false,
      "properties": {
        "aiAdoptionGrowth": {
          "$ref": "#/definitions/Equation",
          "description": "How AI adoption spreads across countries"
        },
        "surplusGeneration": {
          "$ref": "#/definitions/Equation",
          "description": "How corporations generate surplus from AI revenue"
        },
        "wellbeingDelta": {
          "$ref": "#/definitions/Equation",
          "description": "How wellbeing changes each month"
        },
        "displacementFriction": {
          "$ref": "#/definitions/Equation",
          "description": "Negative wellbeing impact from job displacement"
        },
        "ubiUtility": {
          "$ref": "#/definitions/Equation",
          "description": "How UBI converts to wellbeing utility"
        },
        "demandCollapse": {
          "$ref": "#/definitions/Equation",
          "description": "Optional: Customer purchasing power projection"
        },
        "reputationChange": {
          "$ref": "#/definitions/Equation",
          "description": "Optional: Corporation reputation dynamics"
        },
        "giniDamping": {
          "$ref": "#/definitions/Equation",
          "description": "Optional: Inequality effect on UBI utility"
        }
      }
    },

    "Equation": {
      "type": "string",
      "minLength": 1,
      "maxLength": 500,
      "pattern": "^[a-zA-Z0-9_.+\\-*/() <>!=?:,\\s]+$",
      "description": "Mathematical equation string (max 500 chars, alphanumeric + operators only)"
    },

    "ModelMetadata": {
      "type": "object",
      "required": ["author", "version", "createdAt", "description", "overridesStandardCausality"],
      "additionalProperties": false,
      "properties": {
        "author": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "description": "Model author name or organization"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Semantic version (e.g., 1.0.0)"
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of creation"
        },
        "description": {
          "type": "string",
          "minLength": 10,
          "maxLength": 500,
          "description": "Description of model philosophy and approach"
        },
        "overridesStandardCausality": {
          "type": "boolean",
          "description": "True if model intentionally deviates from expected causal relationships"
        },
        "justification": {
          "type": "string",
          "minLength": 20,
          "maxLength": 500,
          "description": "Required if overridesStandardCausality is true - explain why"
        },
        "tags": {
          "type": "array",
          "maxItems": 10,
          "items": {
            "type": "string",
            "minLength": 1,
            "maxLength": 30,
            "pattern": "^[a-z0-9-]+$"
          },
          "description": "Optional tags for categorization"
        }
      },
      "if": {
        "properties": {
          "overridesStandardCausality": { "const": true }
        }
      },
      "then": {
        "required": ["justification"]
      }
    }
  }
}
